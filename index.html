<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>M5Stack Connect Test</title>
<style>
  /* --- ã“ã“ã«CSSãŒå…¥ã£ã¦ã„ã¾ã™ --- */
  body { font-family: sans-serif; text-align: center; background: #f2f2f7; padding: 20px; }
  .container { background: white; padding: 30px; border-radius: 16px; margin: 0 auto; max-width: 400px; }
  .status { font-size: 24px; font-weight: bold; margin: 20px 0; }
  .circle { font-size: 50px; display: block; margin-bottom: 10px; }
  button { width: 100%; padding: 15px; font-size: 16px; border: none; border-radius: 8px; margin-bottom: 10px; font-weight: bold; cursor: pointer; }
  #btn-connect { background: #3182ce; color: white; }
  #btn-disconnect { background: #e53e3e; color: white; opacity: 0.5; }
</style>
</head>
<body>

<div class="container">
    <h2>M5Stack æ¥ç¶šãƒ†ã‚¹ãƒˆ</h2>
    
    <div class="status">
        <span id="circle" class="circle">ğŸ”´</span>
        <span id="text">æœªæ¥ç¶š</span>
    </div>

    <button id="btn-connect" onclick="connect()">æ¥ç¶šã™ã‚‹</button>
    <button id="btn-disconnect" onclick="disconnect()">åˆ‡æ–­ã™ã‚‹</button>

    <p style="font-size:10px; color:#888;">Target: 12345678...</p>
</div>

<script>
  // --- ã“ã“ã«JavaScriptãŒå…¥ã£ã¦ã„ã¾ã™ ---
  
  // â˜…é‡è¦ï¼šã“ã“ã«M5Stackã¨åŒã˜UUIDã‚’å…¥ã‚Œã‚‹
  const SERVICE_UUID = "12345678-1234-1234-1234-1234567890ab".toLowerCase();

  let device = null;

  async function connect() {
      // 1. ã¾ãšãƒœã‚¿ãƒ³ãŒç”Ÿãã¦ã„ã‚‹ã‹ç¢ºèªã®ã‚¢ãƒ©ãƒ¼ãƒˆ
      alert("æ¥ç¶šã‚’é–‹å§‹ã—ã¾ã™ï¼");

      try {
          // 2. ãƒ‡ãƒã‚¤ã‚¹ã‚’æ¢ã™
          device = await navigator.bluetooth.requestDevice({
              filters: [{ services: [SERVICE_UUID] }]
          });

          // 3. æ¥ç¶šã™ã‚‹
          const server = await device.gatt.connect();

          // 4. æˆåŠŸã—ãŸã‚‰ç”»é¢ã‚’å¤‰ãˆã‚‹
          document.getElementById("circle").innerText = "ğŸ”µ";
          document.getElementById("text").innerText = "æ¥ç¶šæˆåŠŸï¼";
          document.getElementById("btn-connect").style.opacity = "0.5";
          document.getElementById("btn-disconnect").style.opacity = "1.0";

          alert("ã¤ãªãŒã‚Šã¾ã—ãŸï¼");

      } catch (e) {
          // å¤±æ•—ã—ãŸã‚‰ã‚¨ãƒ©ãƒ¼ã‚’è¡¨ç¤º
          alert("ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¾ã—ãŸ:\n" + e);
      }
  }

  function disconnect() {
      if (device && device.gatt.connected) {
          device.gatt.disconnect();
          document.getElementById("circle").innerText = "ğŸ”´";
          document.getElementById("text").innerText = "æœªæ¥ç¶š";
          document.getElementById("btn-connect").style.opacity = "1.0";
          document.getElementById("btn-disconnect").style.opacity = "0.5";
          alert("åˆ‡æ–­ã—ã¾ã—ãŸ");
      }
  }
</script>

</body>
</html>
