<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>M5Stick Lost Alert</title>
<style>
  body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; text-align: center; background: #f2f2f7; padding: 20px; margin: 0; }
  
  /* ã‚³ãƒ³ãƒ†ãƒŠå…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
  .container { background: white; padding: 30px; border-radius: 16px; margin: 0 auto; max-width: 400px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
  
  /* èµ·å‹•ç”»é¢å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
  .splash-title { font-size: 28px; font-weight: bold; color: #333; margin-bottom: 10px; }
  .splash-subtitle { font-size: 16px; color: #666; margin-bottom: 30px; }
  .splash-icon { font-size: 80px; margin: 20px 0; display: block; }
  
  /* ãƒ¡ã‚¤ãƒ³ç”»é¢ã‚¹ã‚¿ã‚¤ãƒ« */
  .status { font-size: 24px; font-weight: bold; margin: 20px 0; }
  .circle { font-size: 50px; display: block; margin-bottom: 10px; }
  
  /* ãƒœã‚¿ãƒ³å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
  button { width: 100%; padding: 15px; font-size: 16px; border: none; border-radius: 8px; margin-bottom: 10px; font-weight: bold; cursor: pointer; transition: opacity 0.2s; }
  button:active { transform: scale(0.98); }
  
  #btn-start { background: #333; color: white; margin-top: 20px; }
  #btn-connect { background: #3182ce; color: white; }
  #btn-disconnect { background: #e53e3e; color: white; opacity: 0.5; }
  
  /* è­¦å‘Šæ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
  .alert-mode { background-color: #ffeaea !important; border: 2px solid red; animation: shake 0.5s; }
  .alert-text { color: red; font-weight: bold; }

  /* è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆç”¨ã‚¯ãƒ©ã‚¹ */
  .hidden { display: none; }

  @keyframes shake {
    0% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    50% { transform: translateX(5px); }
    75% { transform: translateX(-5px); }
    100% { transform: translateX(0); }
  }
</style>
</head>
<body>

<div id="splash-screen" class="container">
    <span class="splash-icon">ğŸ”’</span>
    <div class="splash-title">ç´›å¤±é˜²æ­¢ã‚¿ã‚°</div>
    <div class="splash-subtitle">M5Stick Anti-Lost Guard</div>
    <p style="color:#888; font-size:12px;">Bluetoothæ¥ç¶šã§<br>ç´›å¤±ã‚’é˜²ãã¾ã™</p>
    <button id="btn-start" onclick="startApp()">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
</div>

<div id="main-container" class="container hidden">
    <h2>æ¥ç¶šã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h2>
    
    <div class="status">
        <span id="circle" class="circle">ğŸ”´</span>
        <span id="text">æœªæ¥ç¶š</span>
    </div>

    <button id="btn-connect" onclick="connect()">æ¥ç¶šã™ã‚‹</button>
    <button id="btn-disconnect" onclick="disconnect()">åˆ‡æ–­ã™ã‚‹</button>
</div>

<script>
  const SERVICE_UUID = "12345678-1234-1234-1234-1234567890ab".toLowerCase();

  let device = null;
  let isManualDisconnect = false;

  // â˜…èµ·å‹•ç”»é¢ã‹ã‚‰ãƒ¡ã‚¤ãƒ³ç”»é¢ã¸é·ç§»ã™ã‚‹é–¢æ•°
  function startApp() {
      document.getElementById('splash-screen').classList.add('hidden');
      document.getElementById('main-container').classList.remove('hidden');
  }

  async function connect() {
      try {
          device = await navigator.bluetooth.requestDevice({
              filters: [{ services: [SERVICE_UUID] }]
          });

          device.addEventListener('gattserverdisconnected', onDisconnected);

          const server = await device.gatt.connect();

          updateUI(true);
          isManualDisconnect = false;

          alert("æ¥ç¶šã—ã¾ã—ãŸ");

      } catch (e) {
          alert("æ¥ç¶šã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€ã¾ãŸã¯ã‚¨ãƒ©ãƒ¼: " + e);
      }
  }

  function disconnect() {
      if (device && device.gatt.connected) {
          isManualDisconnect = true;
          device.gatt.disconnect();
          updateUI(false);
          alert("æ‰‹å‹•ã§åˆ‡æ–­ã—ã¾ã—ãŸ");
      }
  }

  function onDisconnected(event) {
      if (isManualDisconnect) {
          return;
      }

      document.getElementById("circle").innerText = "âš ï¸";
      document.getElementById("text").innerText = "æ¥ç¶šãŒåˆ‡ã‚Œã¾ã—ãŸï¼";
      document.getElementById("text").className = "alert-text";
      document.getElementById("main-container").className = "container alert-mode"; // ã“ã“ã§èµ¤æ ã«ã™ã‚‹

      alert("âš ï¸ è­¦å‘Šï¼ M5Stickã¨ã®æ¥ç¶šãŒå¤±ã‚ã‚Œã¾ã—ãŸï¼");
      
      setTimeout(() => {
        updateUI(false);
        // èµ¤æ ãªã©ã®è­¦å‘Šã‚¹ã‚¿ã‚¤ãƒ«ã‚’è§£é™¤
        document.getElementById("main-container").className = "container";
        document.getElementById("text").className = "";
      }, 1000);
  }

  function updateUI(isConnected) {
      if (isConnected) {
          document.getElementById("circle").innerText = "ğŸ”µ";
          document.getElementById("text").innerText = "æ¥ç¶šä¸­";
          document.getElementById("btn-connect").style.opacity = "0.5";
          document.getElementById("btn-disconnect").style.opacity = "1.0";
      } else {
          document.getElementById("circle").innerText = "ğŸ”´";
          document.getElementById("text").innerText = "æœªæ¥ç¶š";
          document.getElementById("btn-connect").style.opacity = "1.0";
          document.getElementById("btn-disconnect").style.opacity = "0.5";
      }
  }
</script>

</body>
</html>
